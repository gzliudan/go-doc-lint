# Best Practices Guide for go-doc-lint

[中文版](BEST_PRACTICES_cn.md) | English

This guide provides best practices for integrating and using go-doc-lint in your Go projects and CI/CD pipelines.

## Table of Contents

1. [Project Organization](#project-organization)
2. [Common Project Structures](#common-project-structures)
3. [Pre-commit Hook Integration](#pre-commit-hook-integration)
4. [CI/CD Pipeline Integration](#cicd-pipeline-integration)
5. [Performance Optimization](#performance-optimization)
6. [Fixing Documentation Issues](#fixing-documentation-issues)
7. [Common Pitfalls](#common-pitfalls)

---

## Project Organization

### Recommended Go Project Structure

For best results with go-doc-lint, organize your project following Go conventions:

```text
myproject/
├── cmd/               # Command-line applications
│   └── myapp/
│       └── main.go
├── pkg/               # Public libraries
│   ├── api/
│   │   ├── client.go
│   │   └── client_test.go
│   └── auth/
│       ├── token.go
│       └── token_test.go
├── internal/          # Private packages
│   └── config/
│       ├── config.go
│       └── config_test.go
├── test/              # Integration tests
│   └── integration_test.go
├── vendor/            # Vendor dependencies (auto-excluded)
├── go.mod
└── go.sum
```

### File Naming Conventions

**For go-doc-lint to work optimally:**

- **Test files**: Must end with `_test.go`
  - ✅ `client_test.go` - Correct
  - ❌ `client.test.go` - Not recognized as test file
  - ❌ `clienttest.go` - Not recognized as test file

- **Documentation files**: Won't be scanned (Go only scans `.go` files)
  - `README.md`, `doc.md`, etc. are safely ignored

### Common Project Structures

Use these patterns to scan effectively based on your repository layout.

#### Monorepo

Typical layout:

```text
repo/
├── services/
│   ├── user/
│   └── billing/
├── libs/
│   ├── auth/
│   └── common/
└── tools/
```

Recommended scan patterns:

```bash
# Scan all services
./go-doc-lint.sh ./services

# Scan a single service
./go-doc-lint.sh ./services/user

# Scan shared libs
./go-doc-lint.sh ./libs
```

#### Multi-module (multiple go.mod files)

Typical layout:

```text
repo/
├── go.mod
├── api/
│   └── go.mod
└── tools/
  └── go.mod
```

Recommended scan patterns:

```bash
# Scan each module separately
./go-doc-lint.sh .
./go-doc-lint.sh ./api
./go-doc-lint.sh ./tools
```

#### Generated Code and Vendor

Recommendations:

- Generated files often include a marker like `Code generated by`.
- Consider scanning only source directories to avoid noise.
- Vendor directories are excluded automatically, but verify if custom layouts are used.

```bash
# Focus on source directories
./go-doc-lint.sh ./cmd
./go-doc-lint.sh ./pkg
./go-doc-lint.sh ./internal
```

#### Workspace with internal tools

Typical layout:

```text
repo/
├── cmd/
├── internal/
└── tools/
  ├── generator/
  └── linting/
```

Recommended scan patterns:

```bash
# Scan main app and internal packages
./go-doc-lint.sh ./cmd
./go-doc-lint.sh ./internal

# Optionally scan tools
./go-doc-lint.sh ./tools
```

---

## Pre-commit Hook Integration

### Option 1: Using Husky (for JavaScript-based projects)

If your project has a `package.json`, you can use Husky:

```bash
npm install husky --save-dev
npx husky install
npx husky add .husky/pre-commit './go-doc-lint.sh'
```

### Option 2: Using Pre-commit Framework

Create `.pre-commit-hooks.yaml` in your project root:

```yaml
repos:
  - repo: local
    hooks:
      - id: go-doc-lint
        name: go-doc-lint
        entry: bash go-doc-lint.sh
        language: script
        types: [go]
        stages: [commit]
```

Install the hook:

```bash
# Install the pre-commit framework
pip install pre-commit

# Install the hook
pre-commit install

# (Optional) Run on all files
pre-commit run --all-files
```

### Option 3: Manual Git Hook

Create `.git/hooks/pre-commit`:

```bash
#!/bin/bash
set -e

# Run go-doc-lint
if ! bash go-doc-lint.sh ./; then
    echo "Documentation check failed. Fix issues and try again."
    exit 1
fi
```

Make it executable:

```bash
chmod +x .git/hooks/pre-commit
```

---

## CI/CD Pipeline Integration

### GitHub Actions

Create `.github/workflows/lint.yml`:

```yaml
name: Documentation Lint

on: [push, pull_request]

jobs:
  lint-bash:
    name: Lint (Bash)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run go-doc-lint
        run: bash go-doc-lint.sh ./

  lint-powershell:
    name: Lint (PowerShell)
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run go-doc-lint
        run: powershell -File go-doc-lint.ps1 -InputPath "././
```

### GitLab CI

Create `.gitlab-ci.yml`:

```yaml
doc-lint:
  image: golang:latest
  script:
    - bash go-doc-lint.sh ./
  only:
    - merge_requests
    - main
```

### Jenkins

Create `Jenkinsfile`:

```groovy
pipeline {
    agent any

    stages {
        stage('Lint Documentation') {
            steps {
                script {
                    sh 'bash go-doc-lint.sh ./'
                }
            }
        }
    }

    post {
        always {
            archiveArtifacts artifacts: 'go-doc-lint-*.txt', allowEmptyArchive: true
        }
    }
}
```

---

## Performance Optimization

### Scan Performance Characteristics

- **Typical Speed**: 50-100 Go files per second
- **Memory Usage**: < 50MB for typical projects
- **I/O Bound**: Performance depends on disk speed
- **Linear Scaling**: Scans scale linearly with number of files

### Tips for Large Projects (>10,000 files)

1. **Run in Parallel**: Divide directories and scan in parallel

   ```bash
   # Scan different packages in parallel
   bash go-doc-lint.sh ./pkg/auth/ &
   bash go-doc-lint.sh ./pkg/api/ &
   bash go-doc-lint.sh ./pkg/db/ &
   wait
   ```

2. **Exclude Vendor Directory**: Already auto-excluded, but verify

   ```bash
   # This is faster than including vendor
   bash go-doc-lint.sh ./pkg/ --all
   ```

3. **Save to File**: Faster for processing results

   ```bash
   bash go-doc-lint.sh ./ -o results.txt
   ```

4. **Cache Results**: In CI, consider caching between runs

   ```yaml
   # GitHub Actions example
   - uses: actions/cache@v3
     with:
       path: go-doc-lint-*.txt
       key: doc-lint-${{ github.sha }}
   ```

---

## Fixing Documentation Issues

### Step-by-Step Guide

1. **Run the linter and save output**

   ```bash
   bash go-doc-lint.sh ./ -o issues.txt
   ```

2. **Review the report**

   ```text
   File: pkg/auth/token.go
   Comment First Word: read
   Function Name: ReadToken
   Comment Line: // read token from cache
   Function Declaration: func ReadToken(cache Cache) string {
   ```

3. **Fix the issue**

   ```go
   // Before
   // read token from cache
   func ReadToken(cache Cache) string {

   // After
   // ReadToken retrieves token from cache
   func ReadToken(cache Cache) string {
   ```

4. **Re-run to verify**

   ```bash
   bash go-doc-lint.sh ./pkg/auth/token.go
   ```

### Batch Fixing Tips

For large codebases with many issues:

1. **Group by directory** - Fix one package at a time
2. **Use IDE find/replace** - VSCode, GoLand can help fix patterns
3. **Script replacements** - Use `sed` or similar for systematic fixes

```bash
# Example: Replace "read" with "Read" in comments for ReadXxx functions
sed -i 's/\/\/ read /\/\/ Read /g' pkg/auth/*.go
```

---

## Common Pitfalls

### ❌ Pitfall 1: Mismatched Case

```go
// read data from file
func ReadData() {}  // ❌ First word doesn't match (lowercase vs PascalCase)

// ReadData reads data from file
func ReadData() {}  // ✅ Correct
```

**Fix**: Ensure first word of comment matches function name exactly (case-sensitive).

### ❌ Pitfall 2: Using Wrong Punctuation

```go
// Read, data from file
func ReadData() {}  // ❌ Comment is "Read," but function is "ReadData"

// ReadData reads data from file
func ReadData() {}  // ✅ Correct
```

**Fix**: First word must match exactly, with no punctuation attached.

### ❌ Pitfall 3: Comment Too Far Away

```go
// Helper function
func Helper() {}

// This comment is not above the function
func AnotherFunc() {}  // ❌ Missing documentation

// AnotherFunc does something
func AnotherFunc() {}  // ✅ Correct
```

**Fix**: Documentation comment must be immediately above the function.

### ❌ Pitfall 4: Method vs Function Confusion

```go
// read from buffer
func (b Buffer) Read(p []byte) int {  // ✅ This is a method on Buffer type

// ReadFile reads content from file
func ReadFile(path string) []byte {}  // ✅ This is a package-level function
```

**Both work**: go-doc-lint recognizes both methods (with receiver) and package-level functions.

### ❌ Pitfall 5: Method Receiver in Comments

```go
// (b Buffer) Read from buffer
func (b Buffer) Read(p []byte) int {}  // ❌ Don't mention receiver in comment

// Read reads from the buffer
func (b Buffer) Read(p []byte) int {}  // ✅ Correct
```

**Fix**: Comments should only mention the method name, not the receiver.

### ✅ Special Case: TODO Comments

```go
// TODO: optimize this function
func OptimizeMe() {}  // ✅ Allowed - words ending with ':' are exceptions
```

**Special handling**: Words ending with ':' (like TODO:, FIXME:, NOTE:) are automatically excluded from matching.

---

## Export Documentation

### Ensure Public APIs are Documented

In Go, documentation comments are essential for exported (public) types and functions:

```go
// ❌ Public but undocumented
func PublicAPI() {}

// ✅ Properly documented public API
// PublicAPI provides external access to core functionality
func PublicAPI() {}
```

### Using godoc

After fixing documentation:

```bash
# Generate local documentation
godoc -http=:6060

# Visit http://localhost:6060/pkg/github.com/yourname/myproject/
```

---

## Integration Checklist

- [ ] Code is organized following Go conventions
- [ ] Test files end with `_test.go`
- [ ] All exported functions have documentation comments
- [ ] Documentation comments have function name as first word
- [ ] Pre-commit hook is installed and working
- [ ] CI/CD pipeline includes documentation check
- [ ] Team members are aware of documentation requirements
- [ ] Issues are tracked and fixed promptly

---

## Additional Resources

- [Go Code Review Comments - Doc Comments](https://github.com/golang/go/wiki/CodeReviewComments#comment-sentences)
- [Effective Go - Commentary](https://golang.org/doc/effective_go#commentary)
- [godoc Documentation](https://pkg.go.dev/golang.org/x/tools/cmd/godoc)

---

**Last Updated:** 2026-02-01
**Version:** 1.0.0
